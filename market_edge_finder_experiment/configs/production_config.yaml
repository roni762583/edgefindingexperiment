# Market Edge Finder Experiment - Production Configuration
# Production-ready configuration for Docker experiment execution

# OANDA API Configuration - use environment variables
oanda:
  api_key: ""  # Set via OANDA_API_KEY environment variable
  account_id: ""  # Set via OANDA_ACCOUNT_ID environment variable
  environment: "practice"  # practice or live - use practice for experiments
  timeout: 30
  max_retries: 3
  requests_per_second: 10

# Model Architecture Configuration - Optimized for 24 instruments
model:
  # TCNAE parameters - production tuned
  tcnae_input_channels: 5  # 5 features per instrument
  tcnae_sequence_length: 4  # 4-hour lookback
  tcnae_latent_dim: 120    # Compressed representation
  tcnae_hidden_channels: [64, 128, 256]  # Deeper network for production
  tcnae_kernel_size: 3
  tcnae_dropout: 0.3  # Higher dropout for robustness
  
  # LightGBM parameters - production optimized
  gbdt_n_estimators: 2000  # More trees for production
  gbdt_max_depth: 6       # Prevent overfitting
  gbdt_learning_rate: 0.02  # Lower for stability
  gbdt_subsample: 0.7
  gbdt_colsample_bytree: 0.7
  gbdt_reg_alpha: 0.2     # Stronger regularization
  gbdt_reg_lambda: 0.2
  gbdt_min_child_samples: 20
  gbdt_feature_fraction: 0.8
  
  # Context manager parameters
  context_dim: 120
  context_ema_alpha: 0.05  # Slower adaptation for stability
  context_correlation_window: 200  # Longer window for production
  
  # General parameters
  num_instruments: 24
  device: "auto"  # Let system decide optimal device

# Data Processing Configuration - Production settings
data:
  # All 24 major FX pairs for comprehensive coverage
  instruments:
    - "EUR_USD"
    - "GBP_USD" 
    - "USD_JPY"
    - "USD_CHF"
    - "AUD_USD"
    - "USD_CAD"
    - "NZD_USD"
    - "EUR_GBP"
    - "EUR_JPY"
    - "GBP_JPY"
    - "AUD_JPY"
    - "EUR_CHF"
    - "GBP_CHF"
    - "CHF_JPY"
    - "EUR_AUD"
    - "GBP_AUD"
    - "AUD_CHF"
    - "NZD_JPY"
    - "CAD_JPY"
    - "AUD_NZD"
    - "EUR_CAD"
    - "EUR_NZD"
    - "GBP_CAD"
    - "GBP_NZD"
  
  # Data parameters - 3 years for robust training
  granularity: "H1"
  lookback_days: 1095  # 3 years
  
  # Feature engineering - production parameters
  atr_period: 14
  adx_period: 14
  volatility_window: 24
  direction_window: 6
  swing_lookback: 12
  
  # Scaling parameters - percentile based for robustness
  scaling_method: "percentile"
  scaling_window: 200  # Rolling window for percentile calculation
  percentile_clip: 99  # Clip extreme outliers
  
  # Processing optimization
  max_workers: 8  # Use more workers in production
  batch_size: 64  # Larger batches for efficiency
  cache_features: true
  parallel_processing: true

# Training Configuration - Production training pipeline
training:
  # Training parameters - conservative for robustness
  num_epochs: 200  # More epochs for thorough training
  batch_size: 64
  learning_rate: 0.0005  # Lower for stability
  weight_decay: 0.001    # Stronger regularization
  
  # Multi-stage training strategy
  stage1_epochs: 80   # TCNAE pretraining - longer
  stage2_epochs: 60   # Hybrid training
  stage3_epochs: 40   # Cooperative learning
  stage4_epochs: 20   # Adaptive teacher forcing
  
  # Validation - robust validation strategy
  validation_split: 0.15  # Smaller split, more training data
  early_stopping_patience: 15
  early_stopping_min_delta: 0.0005
  
  # Optimization - production settings
  optimizer: "adamw"  # Better for transformers
  scheduler: "cosine"  # Smooth learning rate decay
  mixed_precision: true  # Memory and speed optimization
  gradient_clip_norm: 0.5  # Prevent exploding gradients
  
  # Checkpointing - comprehensive saving
  save_every_n_epochs: 5
  keep_n_checkpoints: 10
  save_best_only: false  # Keep all for analysis
  
  # Walk-forward validation - production timeline
  train_window_months: 18  # Longer training window
  test_window_months: 3    # Longer test window
  step_size_months: 1

# Target Engineering Configuration
targets:
  # USD-scaled pip targets for ML training
  scaling_method: "percentile"  # Match feature scaling
  scaling_window: 200
  target_horizon: 1  # 1-hour ahead prediction
  clip_percentile: 95  # Remove extreme outliers
  
  # Position sizing reference (for CSI calculation only)
  position_size_usd: 100000  # Standard lot size
  min_pip_value: 0.1  # Minimum meaningful movement

# Monte Carlo Validation Configuration
validation:
  # Bootstrap parameters - robust validation
  n_bootstrap_samples: 1000
  bootstrap_sample_ratio: 0.8
  confidence_levels: [0.90, 0.95, 0.99]
  
  # Scenario testing - comprehensive stress testing
  scenarios:
    - "original_bootstrap"
    - "random_10_drop"
    - "tail_20_drop"
    - "oversample_150"
    - "adverse_selection"
    - "early_stop_80"
  
  # Statistical tests
  significance_level: 0.05
  min_sample_size: 1000
  correlation_threshold: 0.02  # Minimum edge threshold

# Evaluation Configuration
evaluation:
  # Edge discovery metrics
  sharpe_threshold: 0.5      # Minimum Sharpe for edge
  max_drawdown_threshold: 0.15  # Maximum acceptable drawdown
  min_sample_size: 2000       # Minimum predictions for validation
  
  # Statistical significance
  confidence_level: 0.95
  multiple_testing_correction: "bonferroni"
  
  # Performance metrics
  calculate_rolling_metrics: true
  rolling_window_days: 30
  regime_analysis: true

# System Configuration - Production environment
environment: "production"
debug_mode: false
strict_validation: true
fail_fast: true

# Paths - Docker-compatible paths
data_path: "/app/data"
models_path: "/app/models"  
logs_path: "/app/logs"
results_path: "/app/results"
cache_path: "/app/cache"

# Logging Configuration - Production logging
logging:
  level: "INFO"
  format: "%(asctime)s - %(name)s - %(levelname)s - %(funcName)s:%(lineno)d - %(message)s"
  file_path: "/app/logs/experiment.log"
  max_file_size: 52428800  # 50MB
  backup_count: 10
  
  # Structured logging for production
  json_format: true
  include_trace_id: true
  
  # Component-specific logging
  model_logging: true
  data_logging: true
  training_logging: true
  evaluation_logging: true
  inference_logging: false  # Disable for experiments

# Resource Management - Production limits
resources:
  max_memory_gb: 16
  max_cpu_cores: 8
  gpu_memory_fraction: 0.8
  worker_timeout: 7200  # 2 hours
  
  # Cache management
  max_cache_size_gb: 4
  clear_cache_on_start: false
  
# Experiment Configuration - Docker execution settings
experiment:
  name: "edge_discovery_experiment"
  description: "Statistical edge discovery across 24 FX pairs using TCNAE+LightGBM"
  save_all_predictions: true
  save_feature_importance: true
  save_model_checkpoints: true
  
  # Reproducibility
  random_seed: 42
  deterministic: true
  
  # Output configuration
  generate_reports: true
  save_visualizations: true
  compress_results: true